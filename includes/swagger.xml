<?xml version="1.0" encoding="UTF-8"?>
<project name="SwaggerGenerate" default="swagger-generate">
    <property name="swagger.module" value="vendor/bin/swagger" />
    <property name="swagger.output" value="htdocs/api/docs" />
    <property name="swagger.cors" value="*" />
    <property name="php.binary" value="php" />
    <property name="swagger.args" value="-o ${swagger.output}" />

    <target name="_check-for-swagger-properties">
        <if>
            <not><isset property="swagger.dir" /></not>
            <then>
                <fail message="Property 'swagger.dir' is empty" />
            </then>
        </if>
    </target>

    <target name="swagger-generate" description="Document REST API" depends="_check-for-swagger-properties">
        <exec
            command="${php.binary} -dmemory_limit=-1 ${swagger.module} ${swagger.dir} ${swagger.args}"
            dir="${final-gene.build.path}"
            checkreturn="false"
            logoutput="true"
        />
    </target>

    <target name="install-swagger-cors" description="Installs a .htaccess with CORS-Settings for Swagger-UI">
        <exec command="mkdir -p ${swagger.output}" />
        <echo file="${swagger.output}/.htaccess" msg="Header always set Access-Control-Allow-Origin &quot;${swagger.cors}&quot;" />
    </target>
</project>
